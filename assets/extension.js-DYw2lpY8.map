{"version":3,"file":"extension.js","mappings":"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","sources":["webpack://references-view/./src/extension.ts","webpack://references-view/./src/types/model.ts","webpack://references-view/./src/references/index.ts","webpack://references-view/external commonjs \"vscode\"","webpack://references-view/./src/utils.ts","webpack://references-view/./src/calls/index.ts","webpack://references-view/./src/highlights.ts","webpack://references-view/./src/types/index.ts","webpack://references-view/./src/references/model.ts","webpack://references-view/./src/calls/model.ts","webpack://references-view/./src/navigation.ts","webpack://references-view/./src/tree.ts","webpack://references-view/webpack/bootstrap","webpack://references-view/webpack/startup"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport * as calls from './calls';\nimport * as references from './references';\nimport { SymbolTree, SymbolTreeInput } from './references-view';\nimport { SymbolsTree } from './tree';\nimport * as types from './types';\n\nexport function activate(context: vscode.ExtensionContext): SymbolTree {\n\n\tconst tree = new SymbolsTree();\n\n\treferences.register(tree, context);\n\tcalls.register(tree, context);\n\ttypes.register(tree, context);\n\n\tfunction setInput(input: SymbolTreeInput<unknown>) {\n\t\ttree.setInput(input);\n\t}\n\n\tfunction getInput(): SymbolTreeInput<unknown> | undefined {\n\t\treturn tree.getInput();\n\t}\n\n\treturn { setInput, getInput };\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { SymbolItemDragAndDrop, SymbolItemEditorHighlights, SymbolItemNavigation, SymbolTreeInput } from '../references-view';\nimport { asResourceUrl, del, getThemeIcon, tail } from '../utils';\n\nexport class TypesTreeInput implements SymbolTreeInput<TypeItem> {\n\n\treadonly title: string;\n\treadonly contextValue: string = 'typeHierarchy';\n\n\tconstructor(\n\t\treadonly location: vscode.Location,\n\t\treadonly direction: TypeHierarchyDirection,\n\t) {\n\t\tthis.title = direction === TypeHierarchyDirection.Supertypes\n\t\t\t? vscode.l10n.t('Supertypes Of')\n\t\t\t: vscode.l10n.t('Subtypes Of');\n\t}\n\n\tasync resolve() {\n\n\t\tconst items = await Promise.resolve(vscode.commands.executeCommand<vscode.TypeHierarchyItem[]>('vscode.prepareTypeHierarchy', this.location.uri, this.location.range.start));\n\t\tconst model = new TypesModel(this.direction, items ?? []);\n\t\tconst provider = new TypeItemDataProvider(model);\n\n\t\tif (model.roots.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn {\n\t\t\tprovider,\n\t\t\tget message() { return model.roots.length === 0 ? vscode.l10n.t('No results.') : undefined; },\n\t\t\tnavigation: model,\n\t\t\thighlights: model,\n\t\t\tdnd: model,\n\t\t\tdispose() {\n\t\t\t\tprovider.dispose();\n\t\t\t}\n\t\t};\n\t}\n\n\twith(location: vscode.Location): TypesTreeInput {\n\t\treturn new TypesTreeInput(location, this.direction);\n\t}\n}\n\n\nexport const enum TypeHierarchyDirection {\n\tSubtypes = 'subtypes',\n\tSupertypes = 'supertypes'\n}\n\n\nexport class TypeItem {\n\n\tchildren?: TypeItem[];\n\n\tconstructor(\n\t\treadonly model: TypesModel,\n\t\treadonly item: vscode.TypeHierarchyItem,\n\t\treadonly parent: TypeItem | undefined,\n\t) { }\n\n\tremove(): void {\n\t\tthis.model.remove(this);\n\t}\n}\n\nclass TypesModel implements SymbolItemNavigation<TypeItem>, SymbolItemEditorHighlights<TypeItem>, SymbolItemDragAndDrop<TypeItem> {\n\n\treadonly roots: TypeItem[] = [];\n\n\tprivate readonly _onDidChange = new vscode.EventEmitter<TypesModel>();\n\treadonly onDidChange = this._onDidChange.event;\n\n\tconstructor(readonly direction: TypeHierarchyDirection, items: vscode.TypeHierarchyItem[]) {\n\t\tthis.roots = items.map(item => new TypeItem(this, item, undefined));\n\t}\n\n\tprivate async _resolveTypes(currentType: TypeItem): Promise<TypeItem[]> {\n\t\tif (this.direction === TypeHierarchyDirection.Supertypes) {\n\t\t\tconst types = await vscode.commands.executeCommand<vscode.TypeHierarchyItem[]>('vscode.provideSupertypes', currentType.item);\n\t\t\treturn types ? types.map(item => new TypeItem(this, item, currentType)) : [];\n\t\t} else {\n\t\t\tconst types = await vscode.commands.executeCommand<vscode.TypeHierarchyItem[]>('vscode.provideSubtypes', currentType.item);\n\t\t\treturn types ? types.map(item => new TypeItem(this, item, currentType)) : [];\n\t\t}\n\t}\n\n\tasync getTypeChildren(item: TypeItem): Promise<TypeItem[]> {\n\t\tif (!item.children) {\n\t\t\titem.children = await this._resolveTypes(item);\n\t\t}\n\t\treturn item.children;\n\t}\n\n\t// -- dnd\n\n\tgetDragUri(item: TypeItem): vscode.Uri | undefined {\n\t\treturn asResourceUrl(item.item.uri, item.item.range);\n\t}\n\n\t// -- navigation\n\n\tlocation(currentType: TypeItem) {\n\t\treturn new vscode.Location(currentType.item.uri, currentType.item.range);\n\t}\n\n\tnearest(uri: vscode.Uri, _position: vscode.Position): TypeItem | undefined {\n\t\treturn this.roots.find(item => item.item.uri.toString() === uri.toString()) ?? this.roots[0];\n\t}\n\n\tnext(from: TypeItem): TypeItem {\n\t\treturn this._move(from, true) ?? from;\n\t}\n\n\tprevious(from: TypeItem): TypeItem {\n\t\treturn this._move(from, false) ?? from;\n\t}\n\n\tprivate _move(item: TypeItem, fwd: boolean): TypeItem | void {\n\t\tif (item.children?.length) {\n\t\t\treturn fwd ? item.children[0] : tail(item.children);\n\t\t}\n\t\tconst array = this.roots.includes(item) ? this.roots : item.parent?.children;\n\t\tif (array?.length) {\n\t\t\tconst idx = array.indexOf(item);\n\t\t\tconst delta = fwd ? 1 : -1;\n\t\t\treturn array[idx + delta + array.length % array.length];\n\t\t}\n\t}\n\n\t// --- highlights\n\n\tgetEditorHighlights(currentType: TypeItem, uri: vscode.Uri): vscode.Range[] | undefined {\n\t\treturn currentType.item.uri.toString() === uri.toString() ? [currentType.item.selectionRange] : undefined;\n\t}\n\n\tremove(item: TypeItem) {\n\t\tconst isInRoot = this.roots.includes(item);\n\t\tconst siblings = isInRoot ? this.roots : item.parent?.children;\n\t\tif (siblings) {\n\t\t\tdel(siblings, item);\n\t\t\tthis._onDidChange.fire(this);\n\t\t}\n\t}\n}\n\nclass TypeItemDataProvider implements vscode.TreeDataProvider<TypeItem> {\n\n\tprivate readonly _emitter = new vscode.EventEmitter<TypeItem | undefined>();\n\treadonly onDidChangeTreeData = this._emitter.event;\n\n\tprivate readonly _modelListener: vscode.Disposable;\n\n\tconstructor(private _model: TypesModel) {\n\t\tthis._modelListener = _model.onDidChange(e => this._emitter.fire(e instanceof TypeItem ? e : undefined));\n\t}\n\n\tdispose(): void {\n\t\tthis._emitter.dispose();\n\t\tthis._modelListener.dispose();\n\t}\n\n\tgetTreeItem(element: TypeItem): vscode.TreeItem {\n\n\t\tconst item = new vscode.TreeItem(element.item.name);\n\t\titem.description = element.item.detail;\n\t\titem.contextValue = 'type-item';\n\t\titem.iconPath = getThemeIcon(element.item.kind);\n\t\titem.command = {\n\t\t\tcommand: 'vscode.open',\n\t\t\ttitle: vscode.l10n.t('Open Type'),\n\t\t\targuments: [\n\t\t\t\telement.item.uri,\n\t\t\t\t{ selection: element.item.selectionRange.with({ end: element.item.selectionRange.start }) } satisfies vscode.TextDocumentShowOptions\n\t\t\t]\n\t\t};\n\t\titem.collapsibleState = vscode.TreeItemCollapsibleState.Collapsed;\n\t\treturn item;\n\t}\n\n\tgetChildren(element?: TypeItem | undefined) {\n\t\treturn element\n\t\t\t? this._model.getTypeChildren(element)\n\t\t\t: this._model.roots;\n\t}\n\n\tgetParent(element: TypeItem) {\n\t\treturn element.parent;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { SymbolsTree } from '../tree';\nimport { FileItem, ReferenceItem, ReferencesModel, ReferencesTreeInput } from './model';\n\nexport function register(tree: SymbolsTree, context: vscode.ExtensionContext): void {\n\n\tfunction findLocations(title: string, command: string) {\n\t\tif (vscode.window.activeTextEditor) {\n\t\t\tconst input = new ReferencesTreeInput(title, new vscode.Location(vscode.window.activeTextEditor.document.uri, vscode.window.activeTextEditor.selection.active), command);\n\t\t\ttree.setInput(input);\n\t\t}\n\t}\n\n\tcontext.subscriptions.push(\n\t\tvscode.commands.registerCommand('references-view.findReferences', () => findLocations('References', 'vscode.executeReferenceProvider')),\n\t\tvscode.commands.registerCommand('references-view.findImplementations', () => findLocations('Implementations', 'vscode.executeImplementationProvider')),\n\t\t// --- legacy name\n\t\tvscode.commands.registerCommand('references-view.find', (...args: any[]) => vscode.commands.executeCommand('references-view.findReferences', ...args)),\n\t\tvscode.commands.registerCommand('references-view.removeReferenceItem', removeReferenceItem),\n\t\tvscode.commands.registerCommand('references-view.copy', copyCommand),\n\t\tvscode.commands.registerCommand('references-view.copyAll', copyAllCommand),\n\t\tvscode.commands.registerCommand('references-view.copyPath', copyPathCommand),\n\t);\n\n\n\t// --- references.preferredLocation setting\n\n\tlet showReferencesDisposable: vscode.Disposable | undefined;\n\tconst config = 'references.preferredLocation';\n\tfunction updateShowReferences(event?: vscode.ConfigurationChangeEvent) {\n\t\tif (event && !event.affectsConfiguration(config)) {\n\t\t\treturn;\n\t\t}\n\t\tconst value = vscode.workspace.getConfiguration().get<string>(config);\n\n\t\tshowReferencesDisposable?.dispose();\n\t\tshowReferencesDisposable = undefined;\n\n\t\tif (value === 'view') {\n\t\t\tshowReferencesDisposable = vscode.commands.registerCommand('editor.action.showReferences', async (uri: vscode.Uri, position: vscode.Position, locations: vscode.Location[]) => {\n\t\t\t\tconst input = new ReferencesTreeInput(vscode.l10n.t('References'), new vscode.Location(uri, position), 'vscode.executeReferenceProvider', locations);\n\t\t\t\ttree.setInput(input);\n\t\t\t});\n\t\t}\n\t}\n\tcontext.subscriptions.push(vscode.workspace.onDidChangeConfiguration(updateShowReferences));\n\tcontext.subscriptions.push({ dispose: () => showReferencesDisposable?.dispose() });\n\tupdateShowReferences();\n}\n\nconst copyAllCommand = async (item: ReferenceItem | FileItem | unknown) => {\n\tif (item instanceof ReferenceItem) {\n\t\tcopyCommand(item.file.model);\n\t} else if (item instanceof FileItem) {\n\t\tcopyCommand(item.model);\n\t}\n};\n\nfunction removeReferenceItem(item: FileItem | ReferenceItem | unknown) {\n\tif (item instanceof FileItem) {\n\t\titem.remove();\n\t} else if (item instanceof ReferenceItem) {\n\t\titem.remove();\n\t}\n}\n\n\nasync function copyCommand(item: ReferencesModel | ReferenceItem | FileItem | unknown) {\n\tlet val: string | undefined;\n\tif (item instanceof ReferencesModel) {\n\t\tval = await item.asCopyText();\n\t} else if (item instanceof ReferenceItem) {\n\t\tval = await item.asCopyText();\n\t} else if (item instanceof FileItem) {\n\t\tval = await item.asCopyText();\n\t}\n\tif (val) {\n\t\tawait vscode.env.clipboard.writeText(val);\n\t}\n}\n\nasync function copyPathCommand(item: FileItem | unknown) {\n\tif (item instanceof FileItem) {\n\t\tif (item.uri.scheme === 'file') {\n\t\t\tvscode.env.clipboard.writeText(item.uri.fsPath);\n\t\t} else {\n\t\t\tvscode.env.clipboard.writeText(item.uri.toString(true));\n\t\t}\n\t}\n}\n","module.exports = require(\"vscode\");","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\n\nexport function del<T>(array: T[], e: T): void {\n\tconst idx = array.indexOf(e);\n\tif (idx >= 0) {\n\t\tarray.splice(idx, 1);\n\t}\n}\n\nexport function tail<T>(array: T[]): T | undefined {\n\treturn array[array.length - 1];\n}\n\nexport function asResourceUrl(uri: vscode.Uri, range: vscode.Range): vscode.Uri {\n\treturn uri.with({ fragment: `L${1 + range.start.line},${1 + range.start.character}-${1 + range.end.line},${1 + range.end.character}` });\n}\n\nexport async function isValidRequestPosition(uri: vscode.Uri, position: vscode.Position) {\n\tconst doc = await vscode.workspace.openTextDocument(uri);\n\tlet range = doc.getWordRangeAtPosition(position);\n\tif (!range) {\n\t\trange = doc.getWordRangeAtPosition(position, /[^\\s]+/);\n\t}\n\treturn Boolean(range);\n}\n\nexport function getPreviewChunks(doc: vscode.TextDocument, range: vscode.Range, beforeLen: number = 8, trim: boolean = true) {\n\tconst previewStart = range.start.with({ character: Math.max(0, range.start.character - beforeLen) });\n\tconst wordRange = doc.getWordRangeAtPosition(previewStart);\n\tlet before = doc.getText(new vscode.Range(wordRange ? wordRange.start : previewStart, range.start));\n\tconst inside = doc.getText(range);\n\tconst previewEnd = range.end.translate(0, 331);\n\tlet after = doc.getText(new vscode.Range(range.end, previewEnd));\n\tif (trim) {\n\t\tbefore = before.replace(/^\\s*/g, '');\n\t\tafter = after.replace(/\\s*$/g, '');\n\t}\n\treturn { before, inside, after };\n}\n\nexport class ContextKey<V> {\n\n\tconstructor(readonly name: string) { }\n\n\tasync set(value: V) {\n\t\tawait vscode.commands.executeCommand('setContext', this.name, value);\n\t}\n\n\tasync reset() {\n\t\tawait vscode.commands.executeCommand('setContext', this.name, undefined);\n\t}\n}\n\nexport class WordAnchor {\n\n\tprivate readonly _version: number;\n\tprivate readonly _word: string | undefined;\n\n\tconstructor(private readonly _doc: vscode.TextDocument, private readonly _position: vscode.Position) {\n\t\tthis._version = _doc.version;\n\t\tthis._word = this._getAnchorWord(_doc, _position);\n\t}\n\n\tprivate _getAnchorWord(doc: vscode.TextDocument, pos: vscode.Position): string | undefined {\n\t\tconst range = doc.getWordRangeAtPosition(pos) || doc.getWordRangeAtPosition(pos, /[^\\s]+/);\n\t\treturn range && doc.getText(range);\n\t}\n\n\tguessedTrackedPosition(): vscode.Position | undefined {\n\t\t// funky entry\n\t\tif (!this._word) {\n\t\t\treturn this._position;\n\t\t}\n\n\t\t// no changes\n\t\tif (this._version === this._doc.version) {\n\t\t\treturn this._position;\n\t\t}\n\n\t\t// no changes here...\n\t\tconst wordNow = this._getAnchorWord(this._doc, this._position);\n\t\tif (this._word === wordNow) {\n\t\t\treturn this._position;\n\t\t}\n\n\t\t// changes: search _word downwards and upwards\n\t\tconst startLine = this._position.line;\n\t\tlet i = 0;\n\t\tlet line: number;\n\t\tlet checked: boolean;\n\t\tdo {\n\t\t\tchecked = false;\n\t\t\t// nth line down\n\t\t\tline = startLine + i;\n\t\t\tif (line < this._doc.lineCount) {\n\t\t\t\tchecked = true;\n\t\t\t\tconst ch = this._doc.lineAt(line).text.indexOf(this._word);\n\t\t\t\tif (ch >= 0) {\n\t\t\t\t\treturn new vscode.Position(line, ch);\n\t\t\t\t}\n\t\t\t}\n\t\t\ti += 1;\n\t\t\t// nth line up\n\t\t\tline = startLine - i;\n\t\t\tif (line >= 0) {\n\t\t\t\tchecked = true;\n\t\t\t\tconst ch = this._doc.lineAt(line).text.indexOf(this._word);\n\t\t\t\tif (ch >= 0) {\n\t\t\t\t\treturn new vscode.Position(line, ch);\n\t\t\t\t}\n\t\t\t}\n\t\t} while (i < 100 && checked);\n\n\t\t// fallback\n\t\treturn this._position;\n\t}\n}\n\n// vscode.SymbolKind.File === 0, Module === 1, etc...\nconst _themeIconIds = [\n\t'symbol-file', 'symbol-module', 'symbol-namespace', 'symbol-package', 'symbol-class', 'symbol-method',\n\t'symbol-property', 'symbol-field', 'symbol-constructor', 'symbol-enum', 'symbol-interface',\n\t'symbol-function', 'symbol-variable', 'symbol-constant', 'symbol-string', 'symbol-number', 'symbol-boolean',\n\t'symbol-array', 'symbol-object', 'symbol-key', 'symbol-null', 'symbol-enum-member', 'symbol-struct',\n\t'symbol-event', 'symbol-operator', 'symbol-type-parameter'\n];\n\nexport function getThemeIcon(kind: vscode.SymbolKind): vscode.ThemeIcon | undefined {\n\tconst id = _themeIconIds[kind];\n\treturn id ? new vscode.ThemeIcon(id) : undefined;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { SymbolsTree } from '../tree';\nimport { ContextKey } from '../utils';\nimport { CallItem, CallsDirection, CallsTreeInput } from './model';\n\nexport function register(tree: SymbolsTree, context: vscode.ExtensionContext): void {\n\n\tconst direction = new RichCallsDirection(context.workspaceState, CallsDirection.Incoming);\n\n\tfunction showCallHierarchy() {\n\t\tif (vscode.window.activeTextEditor) {\n\t\t\tconst input = new CallsTreeInput(new vscode.Location(vscode.window.activeTextEditor.document.uri, vscode.window.activeTextEditor.selection.active), direction.value);\n\t\t\ttree.setInput(input);\n\t\t}\n\t}\n\n\tfunction setCallsDirection(value: CallsDirection, anchor: CallItem | unknown) {\n\t\tdirection.value = value;\n\n\t\tlet newInput: CallsTreeInput | undefined;\n\t\tconst oldInput = tree.getInput();\n\t\tif (anchor instanceof CallItem) {\n\t\t\tnewInput = new CallsTreeInput(new vscode.Location(anchor.item.uri, anchor.item.selectionRange.start), direction.value);\n\t\t} else if (oldInput instanceof CallsTreeInput) {\n\t\t\tnewInput = new CallsTreeInput(oldInput.location, direction.value);\n\t\t}\n\t\tif (newInput) {\n\t\t\ttree.setInput(newInput);\n\t\t}\n\t}\n\n\tcontext.subscriptions.push(\n\t\tvscode.commands.registerCommand('references-view.showCallHierarchy', showCallHierarchy),\n\t\tvscode.commands.registerCommand('references-view.showOutgoingCalls', (item: CallItem | unknown) => setCallsDirection(CallsDirection.Outgoing, item)),\n\t\tvscode.commands.registerCommand('references-view.showIncomingCalls', (item: CallItem | unknown) => setCallsDirection(CallsDirection.Incoming, item)),\n\t\tvscode.commands.registerCommand('references-view.removeCallItem', removeCallItem)\n\t);\n}\n\nfunction removeCallItem(item: CallItem | unknown): void {\n\tif (item instanceof CallItem) {\n\t\titem.remove();\n\t}\n}\n\nclass RichCallsDirection {\n\n\tprivate static _key = 'references-view.callHierarchyMode';\n\n\tprivate _ctxMode = new ContextKey<'showIncoming' | 'showOutgoing'>('references-view.callHierarchyMode');\n\n\tconstructor(\n\t\tprivate _mem: vscode.Memento,\n\t\tprivate _value: CallsDirection = CallsDirection.Outgoing,\n\t) {\n\t\tconst raw = _mem.get<number>(RichCallsDirection._key);\n\t\tif (typeof raw === 'number' && raw >= 0 && raw <= 1) {\n\t\t\tthis.value = raw;\n\t\t} else {\n\t\t\tthis.value = _value;\n\t\t}\n\t}\n\n\tget value() {\n\t\treturn this._value;\n\t}\n\n\tset value(value: CallsDirection) {\n\t\tthis._value = value;\n\t\tthis._ctxMode.set(this._value === CallsDirection.Incoming ? 'showIncoming' : 'showOutgoing');\n\t\tthis._mem.update(RichCallsDirection._key, value);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { SymbolItemEditorHighlights } from './references-view';\n\nexport class EditorHighlights<T> {\n\n\tprivate readonly _decorationType = vscode.window.createTextEditorDecorationType({\n\t\tbackgroundColor: new vscode.ThemeColor('editor.findMatchHighlightBackground'),\n\t\trangeBehavior: vscode.DecorationRangeBehavior.ClosedClosed,\n\t\toverviewRulerLane: vscode.OverviewRulerLane.Center,\n\t\toverviewRulerColor: new vscode.ThemeColor('editor.findMatchHighlightBackground'),\n\t});\n\n\tprivate readonly disposables: vscode.Disposable[] = [];\n\tprivate readonly _ignore = new Set<string>();\n\n\tconstructor(private readonly _view: vscode.TreeView<T>, private readonly _delegate: SymbolItemEditorHighlights<T>) {\n\t\tthis.disposables.push(\n\t\t\tvscode.workspace.onDidChangeTextDocument(e => this._ignore.add(e.document.uri.toString())),\n\t\t\tvscode.window.onDidChangeActiveTextEditor(() => _view.visible && this.update()),\n\t\t\t_view.onDidChangeVisibility(e => e.visible ? this._show() : this._hide()),\n\t\t\t_view.onDidChangeSelection(() => {\n\t\t\t\tif (_view.visible) {\n\t\t\t\t\tthis.update();\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\tthis._show();\n\t}\n\n\tdispose() {\n\t\tvscode.Disposable.from(...this.disposables).dispose();\n\t\tfor (const editor of vscode.window.visibleTextEditors) {\n\t\t\teditor.setDecorations(this._decorationType, []);\n\t\t}\n\t}\n\n\tprivate _show(): void {\n\t\tconst { activeTextEditor: editor } = vscode.window;\n\t\tif (!editor || !editor.viewColumn) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._ignore.has(editor.document.uri.toString())) {\n\t\t\treturn;\n\t\t}\n\t\tconst [anchor] = this._view.selection;\n\t\tif (!anchor) {\n\t\t\treturn;\n\t\t}\n\t\tconst ranges = this._delegate.getEditorHighlights(anchor, editor.document.uri);\n\t\tif (ranges) {\n\t\t\teditor.setDecorations(this._decorationType, ranges);\n\t\t}\n\t}\n\n\tprivate _hide(): void {\n\t\tfor (const editor of vscode.window.visibleTextEditors) {\n\t\t\teditor.setDecorations(this._decorationType, []);\n\t\t}\n\t}\n\n\tupdate(): void {\n\t\tthis._hide();\n\t\tthis._show();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { SymbolsTree } from '../tree';\nimport { ContextKey } from '../utils';\nimport { TypeHierarchyDirection, TypeItem, TypesTreeInput } from './model';\n\nexport function register(tree: SymbolsTree, context: vscode.ExtensionContext): void {\n\n\tconst direction = new RichTypesDirection(context.workspaceState, TypeHierarchyDirection.Subtypes);\n\n\tfunction showTypeHierarchy() {\n\t\tif (vscode.window.activeTextEditor) {\n\t\t\tconst input = new TypesTreeInput(new vscode.Location(vscode.window.activeTextEditor.document.uri, vscode.window.activeTextEditor.selection.active), direction.value);\n\t\t\ttree.setInput(input);\n\t\t}\n\t}\n\n\tfunction setTypeHierarchyDirection(value: TypeHierarchyDirection, anchor: TypeItem | vscode.Location | unknown) {\n\t\tdirection.value = value;\n\n\t\tlet newInput: TypesTreeInput | undefined;\n\t\tconst oldInput = tree.getInput();\n\t\tif (anchor instanceof TypeItem) {\n\t\t\tnewInput = new TypesTreeInput(new vscode.Location(anchor.item.uri, anchor.item.selectionRange.start), direction.value);\n\t\t} else if (anchor instanceof vscode.Location) {\n\t\t\tnewInput = new TypesTreeInput(anchor, direction.value);\n\t\t} else if (oldInput instanceof TypesTreeInput) {\n\t\t\tnewInput = new TypesTreeInput(oldInput.location, direction.value);\n\t\t}\n\t\tif (newInput) {\n\t\t\ttree.setInput(newInput);\n\t\t}\n\t}\n\n\tcontext.subscriptions.push(\n\t\tvscode.commands.registerCommand('references-view.showTypeHierarchy', showTypeHierarchy),\n\t\tvscode.commands.registerCommand('references-view.showSupertypes', (item: TypeItem | vscode.Location | unknown) => setTypeHierarchyDirection(TypeHierarchyDirection.Supertypes, item)),\n\t\tvscode.commands.registerCommand('references-view.showSubtypes', (item: TypeItem | vscode.Location | unknown) => setTypeHierarchyDirection(TypeHierarchyDirection.Subtypes, item)),\n\t\tvscode.commands.registerCommand('references-view.removeTypeItem', removeTypeItem)\n\t);\n}\n\nfunction removeTypeItem(item: TypeItem | unknown): void {\n\tif (item instanceof TypeItem) {\n\t\titem.remove();\n\t}\n}\n\nclass RichTypesDirection {\n\n\tprivate static _key = 'references-view.typeHierarchyMode';\n\n\tprivate _ctxMode = new ContextKey<TypeHierarchyDirection>('references-view.typeHierarchyMode');\n\n\tconstructor(\n\t\tprivate _mem: vscode.Memento,\n\t\tprivate _value: TypeHierarchyDirection = TypeHierarchyDirection.Subtypes,\n\t) {\n\t\tconst raw = _mem.get<TypeHierarchyDirection>(RichTypesDirection._key);\n\t\tif (typeof raw === 'string') {\n\t\t\tthis.value = raw;\n\t\t} else {\n\t\t\tthis.value = _value;\n\t\t}\n\t}\n\n\tget value() {\n\t\treturn this._value;\n\t}\n\n\tset value(value: TypeHierarchyDirection) {\n\t\tthis._value = value;\n\t\tthis._ctxMode.set(value);\n\t\tthis._mem.update(RichTypesDirection._key, value);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { SymbolItemDragAndDrop, SymbolItemEditorHighlights, SymbolItemNavigation, SymbolTreeInput, SymbolTreeModel } from '../references-view';\nimport { asResourceUrl, del, getPreviewChunks, tail } from '../utils';\n\nexport class ReferencesTreeInput implements SymbolTreeInput<FileItem | ReferenceItem> {\n\n\treadonly contextValue: string;\n\n\tconstructor(\n\t\treadonly title: string,\n\t\treadonly location: vscode.Location,\n\t\tprivate readonly _command: string,\n\t\tprivate readonly _result?: vscode.Location[] | vscode.LocationLink[]\n\t) {\n\t\tthis.contextValue = _command;\n\t}\n\n\tasync resolve(): Promise<SymbolTreeModel<FileItem | ReferenceItem> | undefined> {\n\n\t\tlet model: ReferencesModel;\n\t\tif (this._result) {\n\t\t\tmodel = new ReferencesModel(this._result);\n\t\t} else {\n\t\t\tconst resut = await Promise.resolve(vscode.commands.executeCommand<vscode.Location[] | vscode.LocationLink[]>(this._command, this.location.uri, this.location.range.start));\n\t\t\tmodel = new ReferencesModel(resut ?? []);\n\t\t}\n\n\t\tif (model.items.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst provider = new ReferencesTreeDataProvider(model);\n\t\treturn {\n\t\t\tprovider,\n\t\t\tget message() { return model.message; },\n\t\t\tnavigation: model,\n\t\t\thighlights: model,\n\t\t\tdnd: model,\n\t\t\tdispose(): void {\n\t\t\t\tprovider.dispose();\n\t\t\t}\n\t\t};\n\t}\n\n\twith(location: vscode.Location): ReferencesTreeInput {\n\t\treturn new ReferencesTreeInput(this.title, location, this._command);\n\t}\n}\n\nexport class ReferencesModel implements SymbolItemNavigation<FileItem | ReferenceItem>, SymbolItemEditorHighlights<FileItem | ReferenceItem>, SymbolItemDragAndDrop<FileItem | ReferenceItem> {\n\n\tprivate _onDidChange = new vscode.EventEmitter<FileItem | ReferenceItem | undefined>();\n\treadonly onDidChangeTreeData = this._onDidChange.event;\n\n\treadonly items: FileItem[] = [];\n\n\tconstructor(locations: vscode.Location[] | vscode.LocationLink[]) {\n\t\tlet last: FileItem | undefined;\n\t\tfor (const item of locations.sort(ReferencesModel._compareLocations)) {\n\t\t\tconst loc = item instanceof vscode.Location\n\t\t\t\t? item\n\t\t\t\t: new vscode.Location(item.targetUri, item.targetRange);\n\n\t\t\tif (!last || ReferencesModel._compareUriIgnoreFragment(last.uri, loc.uri) !== 0) {\n\t\t\t\tlast = new FileItem(loc.uri.with({ fragment: '' }), [], this);\n\t\t\t\tthis.items.push(last);\n\t\t\t}\n\t\t\tlast.references.push(new ReferenceItem(loc, last));\n\t\t}\n\t}\n\n\tprivate static _compareUriIgnoreFragment(a: vscode.Uri, b: vscode.Uri): number {\n\t\tconst aStr = a.with({ fragment: '' }).toString();\n\t\tconst bStr = b.with({ fragment: '' }).toString();\n\t\tif (aStr < bStr) {\n\t\t\treturn -1;\n\t\t} else if (aStr > bStr) {\n\t\t\treturn 1;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tprivate static _compareLocations(a: vscode.Location | vscode.LocationLink, b: vscode.Location | vscode.LocationLink): number {\n\t\tconst aUri = a instanceof vscode.Location ? a.uri : a.targetUri;\n\t\tconst bUri = b instanceof vscode.Location ? b.uri : b.targetUri;\n\t\tif (aUri.toString() < bUri.toString()) {\n\t\t\treturn -1;\n\t\t} else if (aUri.toString() > bUri.toString()) {\n\t\t\treturn 1;\n\t\t}\n\n\t\tconst aRange = a instanceof vscode.Location ? a.range : a.targetRange;\n\t\tconst bRange = b instanceof vscode.Location ? b.range : b.targetRange;\n\t\tif (aRange.start.isBefore(bRange.start)) {\n\t\t\treturn -1;\n\t\t} else if (aRange.start.isAfter(bRange.start)) {\n\t\t\treturn 1;\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\t// --- adapter\n\n\tget message() {\n\t\tif (this.items.length === 0) {\n\t\t\treturn vscode.l10n.t('No results.');\n\t\t}\n\t\tconst total = this.items.reduce((prev, cur) => prev + cur.references.length, 0);\n\t\tconst files = this.items.length;\n\t\tif (total === 1 && files === 1) {\n\t\t\treturn vscode.l10n.t('{0} result in {1} file', total, files);\n\t\t} else if (total === 1) {\n\t\t\treturn vscode.l10n.t('{0} result in {1} files', total, files);\n\t\t} else if (files === 1) {\n\t\t\treturn vscode.l10n.t('{0} results in {1} file', total, files);\n\t\t} else {\n\t\t\treturn vscode.l10n.t('{0} results in {1} files', total, files);\n\t\t}\n\t}\n\n\tlocation(item: FileItem | ReferenceItem) {\n\t\treturn item instanceof ReferenceItem\n\t\t\t? item.location\n\t\t\t: new vscode.Location(item.uri, item.references[0]?.location.range ?? new vscode.Position(0, 0));\n\t}\n\n\tnearest(uri: vscode.Uri, position: vscode.Position): FileItem | ReferenceItem | undefined {\n\n\t\tif (this.items.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\t// NOTE: this.items is sorted by location (uri/range)\n\t\tfor (const item of this.items) {\n\t\t\tif (item.uri.toString() === uri.toString()) {\n\t\t\t\t// (1) pick the item at the request position\n\t\t\t\tfor (const ref of item.references) {\n\t\t\t\t\tif (ref.location.range.contains(position)) {\n\t\t\t\t\t\treturn ref;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// (2) pick the first item after or last before the request position\n\t\t\t\tlet lastBefore: ReferenceItem | undefined;\n\t\t\t\tfor (const ref of item.references) {\n\t\t\t\t\tif (ref.location.range.end.isAfter(position)) {\n\t\t\t\t\t\treturn ref;\n\t\t\t\t\t}\n\t\t\t\t\tlastBefore = ref;\n\t\t\t\t}\n\t\t\t\tif (lastBefore) {\n\t\t\t\t\treturn lastBefore;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// (3) pick the file with the longest common prefix\n\t\tlet best = 0;\n\t\tconst bestValue = ReferencesModel._prefixLen(this.items[best].toString(), uri.toString());\n\n\t\tfor (let i = 1; i < this.items.length; i++) {\n\t\t\tconst value = ReferencesModel._prefixLen(this.items[i].uri.toString(), uri.toString());\n\t\t\tif (value > bestValue) {\n\t\t\t\tbest = i;\n\t\t\t}\n\t\t}\n\n\t\treturn this.items[best].references[0];\n\t}\n\n\tprivate static _prefixLen(a: string, b: string): number {\n\t\tlet pos = 0;\n\t\twhile (pos < a.length && pos < b.length && a.charCodeAt(pos) === b.charCodeAt(pos)) {\n\t\t\tpos += 1;\n\t\t}\n\t\treturn pos;\n\t}\n\n\tnext(item: FileItem | ReferenceItem): FileItem | ReferenceItem {\n\t\treturn this._move(item, true) ?? item;\n\t}\n\n\tprevious(item: FileItem | ReferenceItem): FileItem | ReferenceItem {\n\t\treturn this._move(item, false) ?? item;\n\t}\n\n\tprivate _move(item: FileItem | ReferenceItem, fwd: boolean): ReferenceItem | void {\n\n\t\tconst delta = fwd ? +1 : -1;\n\n\t\tconst _move = (item: FileItem): FileItem => {\n\t\t\tconst idx = (this.items.indexOf(item) + delta + this.items.length) % this.items.length;\n\t\t\treturn this.items[idx];\n\t\t};\n\n\t\tif (item instanceof FileItem) {\n\t\t\tif (fwd) {\n\t\t\t\treturn _move(item).references[0];\n\t\t\t} else {\n\t\t\t\treturn tail(_move(item).references);\n\t\t\t}\n\t\t}\n\n\t\tif (item instanceof ReferenceItem) {\n\t\t\tconst idx = item.file.references.indexOf(item) + delta;\n\t\t\tif (idx < 0) {\n\t\t\t\treturn tail(_move(item.file).references);\n\t\t\t} else if (idx >= item.file.references.length) {\n\t\t\t\treturn _move(item.file).references[0];\n\t\t\t} else {\n\t\t\t\treturn item.file.references[idx];\n\t\t\t}\n\t\t}\n\t}\n\n\tgetEditorHighlights(_item: FileItem | ReferenceItem, uri: vscode.Uri): vscode.Range[] | undefined {\n\t\tconst file = this.items.find(file => file.uri.toString() === uri.toString());\n\t\treturn file?.references.map(ref => ref.location.range);\n\t}\n\n\tremove(item: FileItem | ReferenceItem) {\n\t\tif (item instanceof FileItem) {\n\t\t\tdel(this.items, item);\n\t\t\tthis._onDidChange.fire(undefined);\n\t\t} else {\n\t\t\tdel(item.file.references, item);\n\t\t\tif (item.file.references.length === 0) {\n\t\t\t\tdel(this.items, item.file);\n\t\t\t\tthis._onDidChange.fire(undefined);\n\t\t\t} else {\n\t\t\t\tthis._onDidChange.fire(item.file);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync asCopyText() {\n\t\tlet result = '';\n\t\tfor (const item of this.items) {\n\t\t\tresult += `${await item.asCopyText()}\\n`;\n\t\t}\n\t\treturn result;\n\t}\n\n\tgetDragUri(item: FileItem | ReferenceItem): vscode.Uri | undefined {\n\t\tif (item instanceof FileItem) {\n\t\t\treturn item.uri;\n\t\t} else {\n\t\t\treturn asResourceUrl(item.file.uri, item.location.range);\n\t\t}\n\t}\n}\n\nclass ReferencesTreeDataProvider implements vscode.TreeDataProvider<FileItem | ReferenceItem> {\n\n\tprivate readonly _listener: vscode.Disposable;\n\tprivate readonly _onDidChange = new vscode.EventEmitter<FileItem | ReferenceItem | undefined>();\n\n\treadonly onDidChangeTreeData = this._onDidChange.event;\n\n\tconstructor(private readonly _model: ReferencesModel) {\n\t\tthis._listener = _model.onDidChangeTreeData(() => this._onDidChange.fire(undefined));\n\t}\n\n\tdispose(): void {\n\t\tthis._onDidChange.dispose();\n\t\tthis._listener.dispose();\n\t}\n\n\tasync getTreeItem(element: FileItem | ReferenceItem) {\n\t\tif (element instanceof FileItem) {\n\t\t\t// files\n\t\t\tconst result = new vscode.TreeItem(element.uri);\n\t\t\tresult.contextValue = 'file-item';\n\t\t\tresult.description = true;\n\t\t\tresult.iconPath = vscode.ThemeIcon.File;\n\t\t\tresult.collapsibleState = vscode.TreeItemCollapsibleState.Collapsed;\n\t\t\treturn result;\n\n\t\t} else {\n\t\t\t// references\n\t\t\tconst { range } = element.location;\n\t\t\tconst doc = await element.getDocument(true);\n\t\t\tconst { before, inside, after } = getPreviewChunks(doc, range);\n\n\t\t\tconst label: vscode.TreeItemLabel = {\n\t\t\t\tlabel: before + inside + after,\n\t\t\t\thighlights: [[before.length, before.length + inside.length]]\n\t\t\t};\n\n\t\t\tconst result = new vscode.TreeItem(label);\n\t\t\tresult.collapsibleState = vscode.TreeItemCollapsibleState.None;\n\t\t\tresult.contextValue = 'reference-item';\n\t\t\tresult.command = {\n\t\t\t\tcommand: 'vscode.open',\n\t\t\t\ttitle: vscode.l10n.t('Open Reference'),\n\t\t\t\targuments: [\n\t\t\t\t\telement.location.uri,\n\t\t\t\t\t{ selection: range.with({ end: range.start }) } satisfies vscode.TextDocumentShowOptions\n\t\t\t\t]\n\t\t\t};\n\t\t\treturn result;\n\t\t}\n\t}\n\n\tasync getChildren(element?: FileItem | ReferenceItem) {\n\t\tif (!element) {\n\t\t\treturn this._model.items;\n\t\t}\n\t\tif (element instanceof FileItem) {\n\t\t\treturn element.references;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tgetParent(element: FileItem | ReferenceItem) {\n\t\treturn element instanceof ReferenceItem ? element.file : undefined;\n\t}\n}\n\nexport class FileItem {\n\n\tconstructor(\n\t\treadonly uri: vscode.Uri,\n\t\treadonly references: Array<ReferenceItem>,\n\t\treadonly model: ReferencesModel\n\t) { }\n\n\t// --- adapter\n\n\tremove(): void {\n\t\tthis.model.remove(this);\n\t}\n\n\tasync asCopyText() {\n\t\tlet result = `${vscode.workspace.asRelativePath(this.uri)}\\n`;\n\t\tfor (const ref of this.references) {\n\t\t\tresult += `  ${await ref.asCopyText()}\\n`;\n\t\t}\n\t\treturn result;\n\t}\n}\n\nexport class ReferenceItem {\n\n\tprivate _document: Thenable<vscode.TextDocument> | undefined;\n\n\tconstructor(\n\t\treadonly location: vscode.Location,\n\t\treadonly file: FileItem,\n\t) { }\n\n\tasync getDocument(warmUpNext?: boolean) {\n\t\tif (!this._document) {\n\t\t\tthis._document = vscode.workspace.openTextDocument(this.location.uri);\n\t\t}\n\t\tif (warmUpNext) {\n\t\t\t// load next document once this document has been loaded\n\t\t\tconst next = this.file.model.next(this.file);\n\t\t\tif (next instanceof FileItem && next !== this.file) {\n\t\t\t\tvscode.workspace.openTextDocument(next.uri);\n\t\t\t} else if (next instanceof ReferenceItem) {\n\t\t\t\tvscode.workspace.openTextDocument(next.location.uri);\n\t\t\t}\n\t\t}\n\t\treturn this._document;\n\t}\n\n\t// --- adapter\n\n\tremove(): void {\n\t\tthis.file.model.remove(this);\n\t}\n\n\tasync asCopyText() {\n\t\tconst doc = await this.getDocument();\n\t\tconst chunks = getPreviewChunks(doc, this.location.range, 21, false);\n\t\treturn `${this.location.range.start.line + 1}, ${this.location.range.start.character + 1}: ${chunks.before + chunks.inside + chunks.after}`;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { SymbolItemDragAndDrop, SymbolItemEditorHighlights, SymbolItemNavigation, SymbolTreeInput } from '../references-view';\nimport { asResourceUrl, del, getThemeIcon, tail } from '../utils';\n\nexport class CallsTreeInput implements SymbolTreeInput<CallItem> {\n\n\treadonly title: string;\n\treadonly contextValue: string = 'callHierarchy';\n\n\tconstructor(\n\t\treadonly location: vscode.Location,\n\t\treadonly direction: CallsDirection,\n\t) {\n\t\tthis.title = direction === CallsDirection.Incoming\n\t\t\t? vscode.l10n.t('Callers Of')\n\t\t\t: vscode.l10n.t('Calls From');\n\t}\n\n\tasync resolve() {\n\n\t\tconst items = await Promise.resolve(vscode.commands.executeCommand<vscode.CallHierarchyItem[]>('vscode.prepareCallHierarchy', this.location.uri, this.location.range.start));\n\t\tconst model = new CallsModel(this.direction, items ?? []);\n\t\tconst provider = new CallItemDataProvider(model);\n\n\t\tif (model.roots.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn {\n\t\t\tprovider,\n\t\t\tget message() { return model.roots.length === 0 ? vscode.l10n.t('No results.') : undefined; },\n\t\t\tnavigation: model,\n\t\t\thighlights: model,\n\t\t\tdnd: model,\n\t\t\tdispose() {\n\t\t\t\tprovider.dispose();\n\t\t\t}\n\t\t};\n\t}\n\n\twith(location: vscode.Location): CallsTreeInput {\n\t\treturn new CallsTreeInput(location, this.direction);\n\t}\n}\n\n\nexport const enum CallsDirection {\n\tIncoming,\n\tOutgoing\n}\n\n\n\nexport class CallItem {\n\n\tchildren?: CallItem[];\n\n\tconstructor(\n\t\treadonly model: CallsModel,\n\t\treadonly item: vscode.CallHierarchyItem,\n\t\treadonly parent: CallItem | undefined,\n\t\treadonly locations: vscode.Location[] | undefined\n\t) { }\n\n\tremove(): void {\n\t\tthis.model.remove(this);\n\t}\n}\n\nclass CallsModel implements SymbolItemNavigation<CallItem>, SymbolItemEditorHighlights<CallItem>, SymbolItemDragAndDrop<CallItem> {\n\n\treadonly roots: CallItem[] = [];\n\n\tprivate readonly _onDidChange = new vscode.EventEmitter<CallsModel>();\n\treadonly onDidChange = this._onDidChange.event;\n\n\tconstructor(readonly direction: CallsDirection, items: vscode.CallHierarchyItem[]) {\n\t\tthis.roots = items.map(item => new CallItem(this, item, undefined, undefined));\n\t}\n\n\tprivate async _resolveCalls(call: CallItem): Promise<CallItem[]> {\n\t\tif (this.direction === CallsDirection.Incoming) {\n\t\t\tconst calls = await vscode.commands.executeCommand<vscode.CallHierarchyIncomingCall[]>('vscode.provideIncomingCalls', call.item);\n\t\t\treturn calls ? calls.map(item => new CallItem(this, item.from, call, item.fromRanges.map(range => new vscode.Location(item.from.uri, range)))) : [];\n\t\t} else {\n\t\t\tconst calls = await vscode.commands.executeCommand<vscode.CallHierarchyOutgoingCall[]>('vscode.provideOutgoingCalls', call.item);\n\t\t\treturn calls ? calls.map(item => new CallItem(this, item.to, call, item.fromRanges.map(range => new vscode.Location(call.item.uri, range)))) : [];\n\t\t}\n\t}\n\n\tasync getCallChildren(call: CallItem): Promise<CallItem[]> {\n\t\tif (!call.children) {\n\t\t\tcall.children = await this._resolveCalls(call);\n\t\t}\n\t\treturn call.children;\n\t}\n\n\t// -- navigation\n\n\tlocation(item: CallItem) {\n\t\treturn new vscode.Location(item.item.uri, item.item.range);\n\t}\n\n\tnearest(uri: vscode.Uri, _position: vscode.Position): CallItem | undefined {\n\t\treturn this.roots.find(item => item.item.uri.toString() === uri.toString()) ?? this.roots[0];\n\t}\n\n\tnext(from: CallItem): CallItem {\n\t\treturn this._move(from, true) ?? from;\n\t}\n\n\tprevious(from: CallItem): CallItem {\n\t\treturn this._move(from, false) ?? from;\n\t}\n\n\tprivate _move(item: CallItem, fwd: boolean): CallItem | void {\n\t\tif (item.children?.length) {\n\t\t\treturn fwd ? item.children[0] : tail(item.children);\n\t\t}\n\t\tconst array = this.roots.includes(item) ? this.roots : item.parent?.children;\n\t\tif (array?.length) {\n\t\t\tconst idx = array.indexOf(item);\n\t\t\tconst delta = fwd ? 1 : -1;\n\t\t\treturn array[idx + delta + array.length % array.length];\n\t\t}\n\t}\n\n\t// --- dnd\n\n\tgetDragUri(item: CallItem): vscode.Uri | undefined {\n\t\treturn asResourceUrl(item.item.uri, item.item.range);\n\t}\n\n\t// --- highlights\n\n\tgetEditorHighlights(item: CallItem, uri: vscode.Uri): vscode.Range[] | undefined {\n\t\tif (!item.locations) {\n\t\t\treturn item.item.uri.toString() === uri.toString() ? [item.item.selectionRange] : undefined;\n\t\t}\n\t\treturn item.locations\n\t\t\t.filter(loc => loc.uri.toString() === uri.toString())\n\t\t\t.map(loc => loc.range);\n\t}\n\n\tremove(item: CallItem) {\n\t\tconst isInRoot = this.roots.includes(item);\n\t\tconst siblings = isInRoot ? this.roots : item.parent?.children;\n\t\tif (siblings) {\n\t\t\tdel(siblings, item);\n\t\t\tthis._onDidChange.fire(this);\n\t\t}\n\t}\n}\n\nclass CallItemDataProvider implements vscode.TreeDataProvider<CallItem> {\n\n\tprivate readonly _emitter = new vscode.EventEmitter<CallItem | undefined>();\n\treadonly onDidChangeTreeData = this._emitter.event;\n\n\tprivate readonly _modelListener: vscode.Disposable;\n\n\tconstructor(private _model: CallsModel) {\n\t\tthis._modelListener = _model.onDidChange(e => this._emitter.fire(e instanceof CallItem ? e : undefined));\n\t}\n\n\tdispose(): void {\n\t\tthis._emitter.dispose();\n\t\tthis._modelListener.dispose();\n\t}\n\n\tgetTreeItem(element: CallItem): vscode.TreeItem {\n\n\t\tconst item = new vscode.TreeItem(element.item.name);\n\t\titem.description = element.item.detail;\n\t\titem.tooltip = item.label && element.item.detail ? `${item.label} - ${element.item.detail}` : item.label ? `${item.label}` : element.item.detail;\n\t\titem.contextValue = 'call-item';\n\t\titem.iconPath = getThemeIcon(element.item.kind);\n\n\t\ttype OpenArgs = [vscode.Uri, vscode.TextDocumentShowOptions];\n\t\tlet openArgs: OpenArgs;\n\n\t\tif (element.model.direction === CallsDirection.Outgoing) {\n\n\t\t\topenArgs = [element.item.uri, { selection: element.item.selectionRange.with({ end: element.item.selectionRange.start }) }];\n\n\t\t} else {\n\t\t\t// incoming call -> reveal first call instead of caller\n\t\t\tlet firstLoctionStart: vscode.Position | undefined;\n\t\t\tif (element.locations) {\n\t\t\t\tfor (const loc of element.locations) {\n\t\t\t\t\tif (loc.uri.toString() === element.item.uri.toString()) {\n\t\t\t\t\t\tfirstLoctionStart = firstLoctionStart?.isBefore(loc.range.start) ? firstLoctionStart : loc.range.start;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!firstLoctionStart) {\n\t\t\t\tfirstLoctionStart = element.item.selectionRange.start;\n\t\t\t}\n\t\t\topenArgs = [element.item.uri, { selection: new vscode.Range(firstLoctionStart, firstLoctionStart) }];\n\t\t}\n\n\t\titem.command = {\n\t\t\tcommand: 'vscode.open',\n\t\t\ttitle: vscode.l10n.t('Open Call'),\n\t\t\targuments: openArgs\n\t\t};\n\t\titem.collapsibleState = vscode.TreeItemCollapsibleState.Collapsed;\n\t\treturn item;\n\t}\n\n\tgetChildren(element?: CallItem | undefined) {\n\t\treturn element\n\t\t\t? this._model.getCallChildren(element)\n\t\t\t: this._model.roots;\n\t}\n\n\tgetParent(element: CallItem) {\n\t\treturn element.parent;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { SymbolItemNavigation } from './references-view';\nimport { ContextKey } from './utils';\n\nexport class Navigation {\n\n\tprivate readonly _disposables: vscode.Disposable[] = [];\n\tprivate readonly _ctxCanNavigate = new ContextKey<boolean>('references-view.canNavigate');\n\n\tprivate _delegate?: SymbolItemNavigation<unknown>;\n\n\tconstructor(private readonly _view: vscode.TreeView<unknown>) {\n\t\tthis._disposables.push(\n\t\t\tvscode.commands.registerCommand('references-view.next', () => this.next(false)),\n\t\t\tvscode.commands.registerCommand('references-view.prev', () => this.previous(false)),\n\t\t);\n\t}\n\n\tdispose(): void {\n\t\tvscode.Disposable.from(...this._disposables).dispose();\n\t}\n\n\tupdate(delegate: SymbolItemNavigation<unknown> | undefined) {\n\t\tthis._delegate = delegate;\n\t\tthis._ctxCanNavigate.set(Boolean(this._delegate));\n\t}\n\n\tprivate _anchor(): undefined | unknown {\n\t\tif (!this._delegate) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst [sel] = this._view.selection;\n\t\tif (sel) {\n\t\t\treturn sel;\n\t\t}\n\t\tif (!vscode.window.activeTextEditor) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn this._delegate.nearest(vscode.window.activeTextEditor.document.uri, vscode.window.activeTextEditor.selection.active);\n\t}\n\n\tprivate _open(loc: vscode.Location, preserveFocus: boolean) {\n\t\tvscode.commands.executeCommand('vscode.open', loc.uri, {\n\t\t\tselection: new vscode.Selection(loc.range.start, loc.range.start),\n\t\t\tpreserveFocus\n\t\t});\n\t}\n\n\tprevious(preserveFocus: boolean): void {\n\t\tif (!this._delegate) {\n\t\t\treturn;\n\t\t}\n\t\tconst item = this._anchor();\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\t\tconst newItem = this._delegate.previous(item);\n\t\tconst newLocation = this._delegate.location(newItem);\n\t\tif (newLocation) {\n\t\t\tthis._view.reveal(newItem, { select: true, focus: true });\n\t\t\tthis._open(newLocation, preserveFocus);\n\t\t}\n\t}\n\n\tnext(preserveFocus: boolean): void {\n\t\tif (!this._delegate) {\n\t\t\treturn;\n\t\t}\n\t\tconst item = this._anchor();\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\t\tconst newItem = this._delegate.next(item);\n\t\tconst newLocation = this._delegate.location(newItem);\n\t\tif (newLocation) {\n\t\t\tthis._view.reveal(newItem, { select: true, focus: true });\n\t\t\tthis._open(newLocation, preserveFocus);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { EditorHighlights } from './highlights';\nimport { Navigation } from './navigation';\nimport { SymbolItemDragAndDrop, SymbolTreeInput } from './references-view';\nimport { ContextKey, isValidRequestPosition, WordAnchor } from './utils';\n\n\nexport class SymbolsTree {\n\n\treadonly viewId = 'references-view.tree';\n\n\tprivate readonly _ctxIsActive = new ContextKey<boolean>('reference-list.isActive');\n\tprivate readonly _ctxHasResult = new ContextKey<boolean>('reference-list.hasResult');\n\tprivate readonly _ctxInputSource = new ContextKey<string>('reference-list.source');\n\n\tprivate readonly _history = new TreeInputHistory(this);\n\tprivate readonly _provider = new TreeDataProviderDelegate();\n\tprivate readonly _dnd = new TreeDndDelegate();\n\tprivate readonly _tree: vscode.TreeView<unknown>;\n\tprivate readonly _navigation: Navigation;\n\n\tprivate _input?: SymbolTreeInput<unknown>;\n\tprivate _sessionDisposable?: vscode.Disposable;\n\n\tconstructor() {\n\t\tthis._tree = vscode.window.createTreeView<unknown>(this.viewId, {\n\t\t\ttreeDataProvider: this._provider,\n\t\t\tshowCollapseAll: true,\n\t\t\tdragAndDropController: this._dnd\n\t\t});\n\t\tthis._navigation = new Navigation(this._tree);\n\t}\n\n\tdispose(): void {\n\t\tthis._history.dispose();\n\t\tthis._tree.dispose();\n\t\tthis._sessionDisposable?.dispose();\n\t}\n\n\tgetInput(): SymbolTreeInput<unknown> | undefined {\n\t\treturn this._input;\n\t}\n\n\tasync setInput(input: SymbolTreeInput<unknown>) {\n\n\t\tif (!await isValidRequestPosition(input.location.uri, input.location.range.start)) {\n\t\t\tthis.clearInput();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._ctxInputSource.set(input.contextValue);\n\t\tthis._ctxIsActive.set(true);\n\t\tthis._ctxHasResult.set(true);\n\t\tvscode.commands.executeCommand(`${this.viewId}.focus`);\n\n\t\tconst newInputKind = !this._input || Object.getPrototypeOf(this._input) !== Object.getPrototypeOf(input);\n\t\tthis._input = input;\n\t\tthis._sessionDisposable?.dispose();\n\n\t\tthis._tree.title = input.title;\n\t\tthis._tree.message = newInputKind ? undefined : this._tree.message;\n\n\t\tconst modelPromise = Promise.resolve(input.resolve());\n\n\t\t// set promise to tree data provider to trigger tree loading UI\n\t\tthis._provider.update(modelPromise.then(model => model?.provider ?? this._history));\n\t\tthis._dnd.update(modelPromise.then(model => model?.dnd));\n\n\t\tconst model = await modelPromise;\n\t\tif (this._input !== input) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!model) {\n\t\t\tthis.clearInput();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._history.add(input);\n\t\tthis._tree.message = model.message;\n\n\t\t// navigation\n\t\tthis._navigation.update(model.navigation);\n\n\t\t// reveal & select\n\t\tconst selection = model.navigation?.nearest(input.location.uri, input.location.range.start);\n\t\tif (selection && this._tree.visible) {\n\t\t\tawait this._tree.reveal(selection, { select: true, focus: true, expand: true });\n\t\t}\n\n\t\tconst disposables: vscode.Disposable[] = [];\n\n\t\t// editor highlights\n\t\tlet highlights: EditorHighlights<unknown> | undefined;\n\t\tif (model.highlights) {\n\t\t\thighlights = new EditorHighlights(this._tree, model.highlights);\n\t\t\tdisposables.push(highlights);\n\t\t}\n\n\t\t// listener\n\t\tif (model.provider.onDidChangeTreeData) {\n\t\t\tdisposables.push(model.provider.onDidChangeTreeData(() => {\n\t\t\t\tthis._tree.title = input.title;\n\t\t\t\tthis._tree.message = model.message;\n\t\t\t\thighlights?.update();\n\t\t\t}));\n\t\t}\n\t\tif (typeof model.dispose === 'function') {\n\t\t\tdisposables.push(new vscode.Disposable(() => model.dispose!()));\n\t\t}\n\t\tthis._sessionDisposable = vscode.Disposable.from(...disposables);\n\t}\n\n\tclearInput(): void {\n\t\tthis._sessionDisposable?.dispose();\n\t\tthis._input = undefined;\n\t\tthis._ctxHasResult.set(false);\n\t\tthis._ctxInputSource.reset();\n\t\tthis._tree.title = vscode.l10n.t('References');\n\t\tthis._tree.message = this._history.size === 0\n\t\t\t? vscode.l10n.t('No results.')\n\t\t\t: vscode.l10n.t('No results. Try running a previous search again:');\n\t\tthis._provider.update(Promise.resolve(this._history));\n\t}\n}\n\n// --- tree data\n\ninterface ActiveTreeDataProviderWrapper {\n\tprovider: Promise<vscode.TreeDataProvider<any>>;\n}\n\nclass TreeDataProviderDelegate implements vscode.TreeDataProvider<undefined> {\n\n\tprovider?: Promise<vscode.TreeDataProvider<any>>;\n\n\tprivate _sessionDispoables?: vscode.Disposable;\n\tprivate _onDidChange = new vscode.EventEmitter<any>();\n\n\treadonly onDidChangeTreeData = this._onDidChange.event;\n\n\tupdate(provider: Promise<vscode.TreeDataProvider<any>>) {\n\n\t\tthis._sessionDispoables?.dispose();\n\t\tthis._sessionDispoables = undefined;\n\n\t\tthis._onDidChange.fire(undefined);\n\n\t\tthis.provider = provider;\n\n\t\tprovider.then(value => {\n\t\t\tif (this.provider === provider && value.onDidChangeTreeData) {\n\t\t\t\tthis._sessionDispoables = value.onDidChangeTreeData(this._onDidChange.fire, this._onDidChange);\n\t\t\t}\n\t\t}).catch(err => {\n\t\t\tthis.provider = undefined;\n\t\t\tconsole.error(err);\n\t\t});\n\t}\n\n\tasync getTreeItem(element: unknown) {\n\t\tthis._assertProvider();\n\t\treturn (await this.provider).getTreeItem(element);\n\t}\n\n\tasync getChildren(parent?: unknown | undefined) {\n\t\tthis._assertProvider();\n\t\treturn (await this.provider).getChildren(parent);\n\t}\n\n\tasync getParent(element: unknown) {\n\t\tthis._assertProvider();\n\t\tconst provider = await this.provider;\n\t\treturn provider.getParent ? provider.getParent(element) : undefined;\n\t}\n\n\tprivate _assertProvider(): asserts this is ActiveTreeDataProviderWrapper {\n\t\tif (!this.provider) {\n\t\t\tthrow new Error('MISSING provider');\n\t\t}\n\t}\n}\n\n// --- tree dnd\n\nclass TreeDndDelegate implements vscode.TreeDragAndDropController<undefined> {\n\n\tprivate _delegate: SymbolItemDragAndDrop<undefined> | undefined;\n\n\treadonly dropMimeTypes: string[] = [];\n\n\treadonly dragMimeTypes: string[] = ['text/uri-list'];\n\n\tupdate(delegate: Promise<SymbolItemDragAndDrop<unknown> | undefined>) {\n\t\tthis._delegate = undefined;\n\t\tdelegate.then(value => this._delegate = value);\n\t}\n\n\thandleDrag(source: undefined[], data: vscode.DataTransfer) {\n\t\tif (this._delegate) {\n\t\t\tconst urls: string[] = [];\n\t\t\tfor (const item of source) {\n\t\t\t\tconst uri = this._delegate.getDragUri(item);\n\t\t\t\tif (uri) {\n\t\t\t\t\turls.push(uri.toString());\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (urls.length > 0) {\n\t\t\t\tdata.set('text/uri-list', new vscode.DataTransferItem(urls.join('\\r\\n')));\n\t\t\t}\n\t\t}\n\t}\n\n\thandleDrop(): void | Thenable<void> {\n\t\tthrow new Error('Method not implemented.');\n\t}\n}\n\n// --- history\n\nclass HistoryItem {\n\n\treadonly description: string;\n\n\tconstructor(\n\t\treadonly key: string,\n\t\treadonly word: string,\n\t\treadonly anchor: WordAnchor,\n\t\treadonly input: SymbolTreeInput<unknown>,\n\t) {\n\t\tthis.description = `${vscode.workspace.asRelativePath(input.location.uri)}  ${input.title.toLocaleLowerCase()}`;\n\t}\n}\n\nclass TreeInputHistory implements vscode.TreeDataProvider<HistoryItem> {\n\n\tprivate readonly _onDidChangeTreeData = new vscode.EventEmitter<HistoryItem | undefined>();\n\treadonly onDidChangeTreeData = this._onDidChangeTreeData.event;\n\n\tprivate readonly _disposables: vscode.Disposable[] = [];\n\tprivate readonly _ctxHasHistory = new ContextKey<boolean>('reference-list.hasHistory');\n\tprivate readonly _inputs = new Map<string, HistoryItem>();\n\n\tconstructor(private readonly _tree: SymbolsTree) {\n\n\t\tthis._disposables.push(\n\t\t\tvscode.commands.registerCommand('references-view.clear', () => _tree.clearInput()),\n\t\t\tvscode.commands.registerCommand('references-view.clearHistory', () => {\n\t\t\t\tthis.clear();\n\t\t\t\t_tree.clearInput();\n\t\t\t}),\n\t\t\tvscode.commands.registerCommand('references-view.refind', (item) => {\n\t\t\t\tif (item instanceof HistoryItem) {\n\t\t\t\t\tthis._reRunHistoryItem(item);\n\t\t\t\t}\n\t\t\t}),\n\t\t\tvscode.commands.registerCommand('references-view.refresh', () => {\n\t\t\t\tconst item = Array.from(this._inputs.values()).pop();\n\t\t\t\tif (item) {\n\t\t\t\t\tthis._reRunHistoryItem(item);\n\t\t\t\t}\n\t\t\t}),\n\t\t\tvscode.commands.registerCommand('_references-view.showHistoryItem', async (item) => {\n\t\t\t\tif (item instanceof HistoryItem) {\n\t\t\t\t\tconst position = item.anchor.guessedTrackedPosition() ?? item.input.location.range.start;\n\t\t\t\t\tawait vscode.commands.executeCommand('vscode.open', item.input.location.uri, { selection: new vscode.Range(position, position) });\n\t\t\t\t}\n\t\t\t}),\n\t\t\tvscode.commands.registerCommand('references-view.pickFromHistory', async () => {\n\t\t\t\tinterface HistoryPick extends vscode.QuickPickItem {\n\t\t\t\t\titem: HistoryItem;\n\t\t\t\t}\n\t\t\t\tconst entries = await this.getChildren();\n\t\t\t\tconst picks = entries.map((item): HistoryPick => ({\n\t\t\t\t\tlabel: item.word,\n\t\t\t\t\tdescription: item.description,\n\t\t\t\t\titem\n\t\t\t\t}));\n\t\t\t\tconst pick = await vscode.window.showQuickPick(picks, { placeHolder: vscode.l10n.t('Select previous reference search') });\n\t\t\t\tif (pick) {\n\t\t\t\t\tthis._reRunHistoryItem(pick.item);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t}\n\n\tdispose(): void {\n\t\tvscode.Disposable.from(...this._disposables).dispose();\n\t\tthis._onDidChangeTreeData.dispose();\n\t}\n\n\tprivate _reRunHistoryItem(item: HistoryItem): void {\n\t\tthis._inputs.delete(item.key);\n\t\tconst newPosition = item.anchor.guessedTrackedPosition();\n\t\tlet newInput = item.input;\n\t\t// create a new input when having a tracked position which is\n\t\t// different than the original position.\n\t\tif (newPosition && !item.input.location.range.start.isEqual(newPosition)) {\n\t\t\tnewInput = item.input.with(new vscode.Location(item.input.location.uri, newPosition));\n\t\t}\n\t\tthis._tree.setInput(newInput);\n\t}\n\n\tasync add(input: SymbolTreeInput<unknown>) {\n\n\t\tconst doc = await vscode.workspace.openTextDocument(input.location.uri);\n\n\t\tconst anchor = new WordAnchor(doc, input.location.range.start);\n\t\tconst range = doc.getWordRangeAtPosition(input.location.range.start) ?? doc.getWordRangeAtPosition(input.location.range.start, /[^\\s]+/);\n\t\tconst word = range ? doc.getText(range) : '???';\n\n\t\tconst item = new HistoryItem(JSON.stringify([range?.start ?? input.location.range.start, input.location.uri, input.title]), word, anchor, input);\n\t\t// use filo-ordering of native maps\n\t\tthis._inputs.delete(item.key);\n\t\tthis._inputs.set(item.key, item);\n\t\tthis._ctxHasHistory.set(true);\n\t}\n\n\tclear(): void {\n\t\tthis._inputs.clear();\n\t\tthis._ctxHasHistory.set(false);\n\t\tthis._onDidChangeTreeData.fire(undefined);\n\t}\n\n\tget size() {\n\t\treturn this._inputs.size;\n\t}\n\n\t// --- tree data provider\n\n\tgetTreeItem(item: HistoryItem): vscode.TreeItem {\n\t\tconst result = new vscode.TreeItem(item.word);\n\t\tresult.description = item.description;\n\t\tresult.command = { command: '_references-view.showHistoryItem', arguments: [item], title: vscode.l10n.t('Rerun') };\n\t\tresult.collapsibleState = vscode.TreeItemCollapsibleState.None;\n\t\tresult.contextValue = 'history-item';\n\t\treturn result;\n\t}\n\n\tgetChildren() {\n\t\treturn Promise.all([...this._inputs.values()].reverse());\n\t}\n\n\tgetParent() {\n\t\treturn undefined;\n\t}\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(15);\n"],"names":["context","tree","SymbolsTree","references","register","calls","types","setInput","input","getInput","TypesTreeInput","location","direction","title","contextValue","constructor","this","vscode","l10n","t","resolve","items","Promise","commands","executeCommand","uri","range","start","model","TypesModel","provider","TypeItemDataProvider","roots","length","message","undefined","navigation","highlights","dnd","dispose","TypeItem","item","parent","children","remove","_onDidChange","EventEmitter","onDidChange","event","map","_resolveTypes","currentType","getTypeChildren","getDragUri","asResourceUrl","Location","nearest","_position","find","toString","next","from","_move","previous","fwd","tail","array","includes","idx","indexOf","getEditorHighlights","selectionRange","siblings","del","fire","_model","_emitter","onDidChangeTreeData","_modelListener","e","getTreeItem","element","TreeItem","name","description","detail","iconPath","getThemeIcon","kind","command","arguments","selection","with","end","collapsibleState","TreeItemCollapsibleState","Collapsed","getChildren","getParent","findLocations","window","activeTextEditor","ReferencesTreeInput","document","active","showReferencesDisposable","subscriptions","push","registerCommand","args","removeReferenceItem","copyCommand","copyAllCommand","copyPathCommand","config","updateShowReferences","affectsConfiguration","value","workspace","getConfiguration","get","async","position","locations","onDidChangeConfiguration","ReferenceItem","file","FileItem","val","ReferencesModel","asCopyText","env","clipboard","writeText","scheme","fsPath","module","exports","require","splice","fragment","line","character","doc","openTextDocument","getWordRangeAtPosition","Boolean","beforeLen","trim","previewStart","Math","max","wordRange","before","getText","Range","inside","previewEnd","translate","after","replace","id","_themeIconIds","ThemeIcon","set","reset","_doc","_version","_word","version","_getAnchorWord","pos","guessedTrackedPosition","wordNow","startLine","checked","i","lineCount","ch","lineAt","text","Position","RichCallsDirection","workspaceState","setCallsDirection","anchor","newInput","oldInput","CallItem","CallsTreeInput","removeCallItem","_mem","_value","static","_ctxMode","ContextKey","raw","_key","update","_view","_delegate","_decorationType","createTextEditorDecorationType","backgroundColor","ThemeColor","rangeBehavior","DecorationRangeBehavior","ClosedClosed","overviewRulerLane","OverviewRulerLane","Center","overviewRulerColor","disposables","_ignore","Set","onDidChangeTextDocument","add","onDidChangeActiveTextEditor","visible","onDidChangeVisibility","_show","_hide","onDidChangeSelection","Disposable","editor","visibleTextEditors","setDecorations","viewColumn","has","ranges","RichTypesDirection","setTypeHierarchyDirection","removeTypeItem","_command","_result","resut","ReferencesTreeDataProvider","last","sort","_compareLocations","loc","targetUri","targetRange","_compareUriIgnoreFragment","a","b","aStr","bStr","aUri","bUri","aRange","bRange","isBefore","isAfter","total","reduce","prev","cur","files","ref","contains","lastBefore","best","bestValue","_prefixLen","charCodeAt","delta","_item","result","_listener","File","getDocument","getPreviewChunks","label","None","asRelativePath","_document","warmUpNext","chunks","CallsModel","CallItemDataProvider","_resolveCalls","call","fromRanges","to","getCallChildren","filter","openArgs","tooltip","firstLoctionStart","_disposables","_ctxCanNavigate","delegate","_anchor","sel","_open","preserveFocus","Selection","newItem","newLocation","reveal","select","focus","viewId","_ctxIsActive","_ctxHasResult","_ctxInputSource","_history","TreeInputHistory","_provider","TreeDataProviderDelegate","_dnd","TreeDndDelegate","_tree","_navigation","_input","_sessionDisposable","createTreeView","treeDataProvider","showCollapseAll","dragAndDropController","Navigation","isValidRequestPosition","clearInput","newInputKind","Object","getPrototypeOf","modelPromise","then","expand","EditorHighlights","size","_sessionDispoables","catch","err","console","error","_assertProvider","Error","dropMimeTypes","dragMimeTypes","handleDrag","source","data","urls","DataTransferItem","join","handleDrop","HistoryItem","key","word","toLocaleLowerCase","_onDidChangeTreeData","_ctxHasHistory","_inputs","Map","clear","_reRunHistoryItem","Array","values","pop","picks","pick","showQuickPick","placeHolder","delete","newPosition","isEqual","WordAnchor","JSON","stringify","all","reverse","__webpack_module_cache__","__webpack_exports__","__webpack_require__","moduleId","cachedModule","__webpack_modules__"],"sourceRoot":""}