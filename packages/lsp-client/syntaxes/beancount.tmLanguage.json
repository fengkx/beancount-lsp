{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "Beancount",
	"patterns": [
		{ "include": "#comments" },
		{ "include": "#directives" },
		{ "include": "#dates" },
		{ "include": "#accounts" },
		{ "include": "#strings" },
		{ "include": "#currencies" },
		{ "include": "#numbers" },
		{ "include": "#tags" },
		{ "include": "#links" },
		{ "include": "#metadata" },
		{ "include": "#operators" },
		{ "include": "#booleans" }
	],
	"repository": {
		"comments": {
			"match": ";.*$",
			"name": "comment"
		},
		"directives": {
			"match": "^(\\s*)(open|close|commodity|balance|pad|note|document|price|event|query|custom|txn|\\*|!|option|plugin|include|poptag|pushtag|popinst|pushinst)\\b",
			"name": "keyword"
		},
		"dates": {
			"match": "\\d{4}[-/]\\d{2}[-/]\\d{2}",
			"name": "constant.numeric"
		},
		"accounts": {
			"match": "\\b(Assets|Liabilities|Equity|Income|Expenses)(:[A-Z][A-Za-z0-9-_]+)+\\b",
			"name": "variable.other.readwrite"
		},
		"strings": {
			"patterns": [
				{
					"name": "string",
					"begin": "\"",
					"end": "\"",
					"patterns": [
						{
							"match": "\\\\.",
							"name": "constant.character.escape"
						}
					]
				},
				{
					"name": "string",
					"match": "\"[^\"]*\""
				}
			]
		},
		"currencies": {
			"match": "\\b[A-Z][A-Z0-9_'.-]{0,22}[A-Z0-9]\\b",
			"name": "constant.other"
		},
		"numbers": {
			"match": "-?\\d+(\\.\\d+)?",
			"name": "constant.numeric"
		},
		"tags": {
			"match": "#[A-Za-z0-9\\-_/.]+",
			"name": "entity.name.tag"
		},
		"links": {
			"match": "\\^[A-Za-z0-9\\-_/.]+",
			"name": "markup.underline.link"
		},
		"metadata": {
			"match": "\\s+([a-z][a-zA-Z0-9\\-_]+):",
			"captures": {
				"1": { "name": "variable.other.property" }
			}
		},
		"operators": {
			"patterns": [
				{ "match": "@@", "name": "keyword.operator.atat.beancount" },
				{ "match": "@", "name": "keyword.operator.at.beancount" },
				{ "match": "\\{\\{", "name": "keyword.operator.brace.double.open.beancount" },
				{ "match": "\\}\\}", "name": "keyword.operator.brace.double.close.beancount" },
				{ "match": "\\{", "name": "keyword.operator.brace.open.beancount" },
				{ "match": "\\}", "name": "keyword.operator.brace.close.beancount" },
				{ "match": "[!&?%PSTCURM#\\*]", "name": "keyword.operator.flag.beancount" }
			]
		},
		"booleans": {
			"match": "\\b(TRUE|FALSE)\\b",
			"name": "constant.language.boolean"
		}
	},
	"scopeName": "source.beancount"
}
